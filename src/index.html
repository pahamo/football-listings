<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Premier League Fixtures & TV Guide - Where to Watch</title>
    <meta name="description" content="Find out which TV channel is showing Premier League matches today. Complete fixture list with Sky Sports, TNT Sports, Amazon Prime and BBC broadcaster information.">
    <meta name="keywords" content="Premier League, TV guide, fixtures, Sky Sports, TNT Sports, Amazon Prime, BBC, where to watch football">
    
    <!-- Open Graph for Social Sharing -->
    <meta property="og:title" content="Premier League Fixtures & TV Guide">
    <meta property="og:description" content="Never miss a match - find out which channel is showing your team's games">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://football-listings.netlify.app">
    
    <style>
        /* ===========================================
           DESIGN TOKENS - Consistent design system
           =========================================== */
        :root {
            /* Colors */
            --primary-color: #1e293b;
            --primary-light: #334155;
            --primary-dark: #0f172a;
            --accent-color: #3b82f6;
            --accent-light: #60a5fa;
            --success-color: #059669;
            --warning-color: #d97706;
            --error-color: #dc2626;
            
            /* Backgrounds */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-card: #ffffff;
            --bg-hover: #f1f5f9;
            
            /* Text */
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --text-muted: #6b7280;
            --text-inverse: #ffffff;
            
            /* Borders */
            --border-color: #e2e8f0;
            --border-color-hover: #cbd5e0;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Typography */
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            
            /* Effects */
            --border-radius: 8px;
            --border-radius-sm: 4px;
            --border-radius-lg: 12px;
            --border-radius-xl: 16px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
        }

        /* ===========================================
           THEME VARIANTS
           =========================================== */
        .theme-dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #e2e8f0;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --border-color-hover: #475569;
            --accent-color: #60a5fa;
            --accent-light: #93c5fd;
        }

        .theme-sport {
            --primary-color: #059669;
            --primary-light: #10b981;
            --accent-color: #f59e0b;
            --accent-light: #fbbf24;
            --success-color: #059669;
            --bg-secondary: #f0fdf4;
        }

        .theme-minimal {
            --primary-color: #374151;
            --accent-color: #6b7280;
            --border-radius: 4px;
            --shadow-md: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --bg-secondary: #f9fafb;
        }

        .theme-pixel {
            /* iOS-inspired color system */
            --primary-color: #007aff;
            --primary-light: #5ac8fa;
            --primary-dark: #0051d5;
            --accent-color: #ff9500;
            --accent-light: #ffb340;
            --success-color: #30d158;
            --warning-color: #ff9f0a;
            
            /* Clean backgrounds with subtle tints */
            --bg-primary: #ffffff;
            --bg-secondary: #f2f2f7;
            --bg-card: rgba(255, 255, 255, 0.8);
            --bg-hover: rgba(0, 0, 0, 0.04);
            
            /* Accessible text colors */
            --text-primary: #000000;
            --text-secondary: #3c3c43;
            --text-muted: #6d6d7d;
            --text-inverse: #ffffff;
            
            /* Subtle borders */
            --border-color: rgba(60, 60, 67, 0.12);
            --border-color-hover: rgba(60, 60, 67, 0.2);
            
            /* iOS-style rounded corners */
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --border-radius-xl: 20px;
            
            /* Soft, elevated shadows */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 12px 32px rgba(0, 0, 0, 0.14);
            
            /* Smooth, natural transitions */
            --transition-fast: 200ms cubic-bezier(0.25, 0.1, 0.25, 1);
            --transition-normal: 300ms cubic-bezier(0.25, 0.1, 0.25, 1);
            --transition-slow: 400ms cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        /* iOS-inspired theme specific styling */
        .theme-pixel .card {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            transition: all var(--transition-normal);
        }

        .theme-pixel .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--border-color-hover);
        }

        .theme-pixel .btn {
            font-weight: 600;
            letter-spacing: -0.01em;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all var(--transition-fast);
        }

        .theme-pixel .btn:hover {
            transform: scale(1.02);
            opacity: 0.8;
        }

        .theme-pixel .btn:active {
            transform: scale(0.98);
        }

        .theme-pixel .matchweek-card {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(255, 255, 255, 0.4) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
        }

        .theme-pixel .fixture-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all var(--transition-normal);
        }

        .theme-pixel .fixture-card:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .theme-pixel .team-crest {
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
        }

        .theme-pixel h1, .theme-pixel h2, .theme-pixel h3 {
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .theme-pixel .theme-switcher {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--border-color);
        }

        /* Dark mode support for pixel theme */
        @media (prefers-color-scheme: dark) {
            .theme-pixel {
                --bg-primary: #000000;
                --bg-secondary: #1c1c1e;
                --bg-card: rgba(28, 28, 30, 0.8);
                --bg-hover: rgba(255, 255, 255, 0.04);
                
                --text-primary: #ffffff;
                --text-secondary: #ebebf5;
                --text-muted: #ebebf5cc;
                --text-inverse: #000000;
                
                --border-color: rgba(84, 84, 88, 0.4);
                --border-color-hover: rgba(84, 84, 88, 0.6);
            }
            
            .theme-pixel .theme-switcher {
                background: rgba(28, 28, 30, 0.8);
            }
            
            .theme-pixel .matchweek-card {
                background: linear-gradient(135deg, var(--bg-card) 0%, rgba(28, 28, 30, 0.4) 100%);
            }
            
            .theme-pixel .fixture-card:hover {
                background: rgba(28, 28, 30, 0.9);
            }
        }

        /* ===========================================
           BASE STYLES
           =========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-family);
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            min-height: 100vh;
            transition: all var(--transition-normal);
        }
        
        /* ===========================================
           UTILITY CLASSES
           =========================================== */

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }

        .flex {
            display: flex;
            gap: var(--spacing-sm);
        }

        .flex--between {
            justify-content: space-between;
        }

        .flex--center {
            align-items: center;
        }

        .flex--wrap {
            flex-wrap: wrap;
        }

        .grid {
            display: grid;
            gap: var(--spacing-md);
        }

        .grid--2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-fast);
        }

        .card:hover {
            border-color: var(--border-color-hover);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card--match {
            padding: var(--spacing-md);
        }

        .card--featured {
            border-color: var(--accent-color);
            box-shadow: var(--shadow-md);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-sm);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .btn--primary {
            background: var(--primary-color);
            color: var(--text-inverse);
        }

        .btn--primary:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
        }

        .btn--accent {
            background: var(--accent-color);
            color: var(--text-inverse);
        }

        .btn--accent:hover {
            background: var(--accent-light);
            transform: translateY(-1px);
        }

        .btn--broadcaster {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn--broadcaster:hover {
            background: var(--bg-hover);
            border-color: var(--border-color-hover);
        }

        /* Typography */
        .text-xs { font-size: var(--font-size-xs); }
        .text-sm { font-size: var(--font-size-sm); }
        .text-lg { font-size: var(--font-size-lg); }
        .text-xl { font-size: var(--font-size-xl); }
        .text-2xl { font-size: var(--font-size-2xl); }
        .text-3xl { font-size: var(--font-size-3xl); }

        .text-muted { color: var(--text-muted); }
        .text-secondary { color: var(--text-secondary); }

        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }

        /* Spacing */
        .mt-sm { margin-top: var(--spacing-sm); }
        .mt-md { margin-top: var(--spacing-md); }
        .mt-lg { margin-top: var(--spacing-lg); }
        .mb-sm { margin-bottom: var(--spacing-sm); }
        .mb-md { margin-bottom: var(--spacing-md); }
        .mb-lg { margin-bottom: var(--spacing-lg); }
        
        /* Theme Switcher */
        .theme-switcher {
            position: fixed;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-sm);
            box-shadow: var(--shadow-md);
            z-index: 1000;
        }

        .theme-switcher select {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            cursor: pointer;
        }

        /* Header */
        header {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-md);
            padding: var(--spacing-lg) 0;
            margin-bottom: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
        }
        
        .logo {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: var(--font-size-3xl);
            font-weight: 700;
            letter-spacing: -0.025em;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            margin-top: var(--spacing-sm);
            font-weight: 400;
        }
        
        /* Status Messages */
        .status {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            text-align: center;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .status.loading {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 197, 253, 0.1) 100%);
            color: #1e40af;
            border-color: rgba(59, 130, 246, 0.2);
        }
        
        .status.success {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(134, 239, 172, 0.1) 100%);
            color: #166534;
            border-color: rgba(34, 197, 94, 0.2);
        }
        
        .status.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(252, 165, 165, 0.1) 100%);
            color: #991b1b;
            border-color: rgba(239, 68, 68, 0.2);
        }
        
        /* Filters */
        .filters {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .filter-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
            letter-spacing: 0.025em;
        }
        
        .filter-group select {
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .filter-group select:hover {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }
        
        .filter-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Matchweek Groups */
        .matchweek-group {
            margin-bottom: 2rem;
        }
        
        .matchweek-header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 16px 16px 0 0;
            font-size: 1.1rem;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }
        
        .matchweek-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            pointer-events: none;
        }
        
        .matchweek-fixtures {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 0 0 16px 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: none;
        }
        
        /* Fixtures */
        .fixture {
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .fixture::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s ease;
        }
        
        .fixture:hover {
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.8) 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .fixture:hover::before {
            left: 100%;
        }
        
        .cardlink {
            display: block;
            text-decoration: none;
            color: inherit;
            transition: all 0.3s ease;
        }
        
        .fixture:last-child {
            border-bottom: none;
        }
        
        .fixture-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .fixture-teams {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .team-badge {
            width: 32px;
            height: 32px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: #666;
            border: 1px solid #ddd;
            overflow: hidden;
        }
        
        .team-badge img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
        }
        
        .vs-text {
            color: #7f8c8d;
            font-weight: normal;
            font-size: 0.9em;
        }
        
        .fixture-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.25rem;
        }
        
        .fixture-date {
            color: #7f8c8d;
            font-size: 0.95rem;
        }
        
        .fixture-venue {
            color: #95a5a6;
            font-size: 0.85rem;
        }
        
        .broadcasters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .no-fixtures {
            text-align: center;
            padding: 3rem;
            color: #7f8c8d;
            font-size: 1.1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Footer */
        footer {
            margin-top: 3rem;
            padding: 2rem 0;
            text-align: center;
            color: #7f8c8d;
            border-top: 1px solid #eee;
        }
        
        .version-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2c3e50;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            z-index: 1000;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .fixture-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .fixture-teams {
                font-size: 1.1rem;
            }
            
            .fixture-info {
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Switcher -->
    <div class="theme-switcher">
        <select id="themeSelect" onchange="switchTheme(this.value)">
            <option value="">Default</option>
            <option value="dark">Dark</option>
            <option value="sport">Sport</option>
            <option value="minimal">Minimal</option>
            <option value="pixel">Pixel</option>
        </select>
    </div>

    <header>
        <div class="container flex flex--between flex--center">
            <div>
                <h1 class="logo" style="margin: 0;">Premier League — UK Listings</h1>
                <p class="subtitle" style="margin: var(--spacing-sm) 0 0 0;">Find out which TV channel is showing your team's matches</p>
            </div>
            <nav class="flex">
                <a href="/football" class="btn btn--primary">Home</a>
                <a href="/football/fixtures" class="btn btn--broadcaster">Fixtures</a>
                <a href="/football/clubs" class="btn btn--broadcaster">Clubs</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Status Messages -->
        <div id="status"></div>
        
        <!-- Filters -->
        <div class="card mb-lg" style="background: var(--bg-card);">
            <div class="flex flex--wrap flex--center">
                <label class="text-sm font-medium" for="team-filter">Filter by Team:</label>
                <select id="team-filter" class="btn btn--broadcaster">
                    <option value="">All Teams</option>
                </select>
                
                <label class="text-sm font-medium" for="matchweek-filter">Matchweek:</label>
                <select id="matchweek-filter" class="btn btn--broadcaster">
                    <option value="">All Matchweeks</option>
                </select>
                
                <label class="text-sm font-medium" for="time-filter">Show:</label>
                <select id="time-filter" class="btn btn--broadcaster">
                    <option value="upcoming">Upcoming Only</option>
                    <option value="all">All Fixtures</option>
                </select>
            </div>
        </div>

        <!-- Fixtures List -->
        <div id="fixtures-container"></div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Football Listings. Find where to watch Premier League matches on TV.</p>
            <p>Data provided by TheSportsDB. Broadcaster information updated regularly.</p>
        </div>
    </footer>

    <div class="version-badge">v1.5.0</div>

    <script>
        // Theme switching functionality
        function switchTheme(theme) {
            const body = document.body;
            // Remove existing theme classes
            body.className = body.className.replace(/theme-\w+/g, '');
            // Add new theme class if selected
            if (theme) {
                body.classList.add(`theme-${theme}`);
            }
            // Store preference
            localStorage.setItem('theme', theme);
        }

        // Load saved theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.getElementById('themeSelect').value = savedTheme;
                switchTheme(savedTheme);
            }
        });

        // Supabase configuration
        const SUPABASE_URL = 'https://ksqyurqkqznzrntdpood.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtzcXl1cnFrcXpuenJudGRwb29kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3OTEwNjAsImV4cCI6MjA3MjM2NzA2MH0.wVBZBEbfctB7JPnpMZkXKMGwXlYxGWjOF_AxixVo-S4';

        // Global state
        let allTeams = [];
        let allFixtures = [];
        let teamsMap = {};

        // Utility Functions
        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function hideStatus() {
            document.getElementById('status').innerHTML = '';
        }

        function getTeamAbbreviation(teamName) {
            const abbreviations = {
                'Arsenal': 'ARS',
                'Aston Villa': 'AVL',
                'Brighton & Hove Albion': 'BHA',
                'Brighton': 'BHA',
                'Burnley': 'BUR',
                'Chelsea': 'CHE',
                'Crystal Palace': 'CRY',
                'Everton': 'EVE',
                'Fulham': 'FUL',
                'Liverpool': 'LIV',
                'Luton Town': 'LUT',
                'Manchester City': 'MCI',
                'Manchester United': 'MUN',
                'Newcastle United': 'NEW',
                'Newcastle': 'NEW',
                'Nottingham Forest': 'NFO',
                'Sheffield United': 'SHU',
                'Tottenham Hotspur': 'TOT',
                'Tottenham': 'TOT',
                'West Ham United': 'WHU',
                'West Ham': 'WHU',
                'Wolverhampton Wanderers': 'WOL',
                'Wolves': 'WOL',
                'Brentford': 'BRE',
                'Leicester City': 'LEI',
                'Leeds United': 'LEE',
                'Sunderland': 'SUN'
            };
            
            return abbreviations[teamName] || teamName.substring(0, 3).toUpperCase();
        }

        function getTeamCrestUrl(teamName) {
            const crestUrls = {
                'Arsenal': 'https://www.thesportsdb.com/images/media/team/badge/vrtrtp1448813175.png',
                'Aston Villa': 'https://www.thesportsdb.com/images/media/team/badge/yvwvtu1448813188.png',
                'Brighton & Hove Albion': 'https://www.thesportsdb.com/images/media/team/badge/wwxuyw1448813221.png',
                'Brighton': 'https://www.thesportsdb.com/images/media/team/badge/wwxuyw1448813221.png',
                'Chelsea': 'https://www.thesportsdb.com/images/media/team/badge/yvwvtu1448813225.png',
                'Crystal Palace': 'https://www.thesportsdb.com/images/media/team/badge/vwpvry1467462651.png',
                'Everton': 'https://www.thesportsdb.com/images/media/team/badge/vwpvry1467462685.png',
                'Fulham': 'https://www.thesportsdb.com/images/media/team/badge/adklsj1672750184.png',
                'Liverpool': 'https://www.thesportsdb.com/images/media/team/badge/txrxpy1448813215.png',
                'Manchester City': 'https://www.thesportsdb.com/images/media/team/badge/vwpvry1467462692.png',
                'Manchester United': 'https://www.thesportsdb.com/images/media/team/badge/vrtrtp1448813187.png',
                'Newcastle United': 'https://www.thesportsdb.com/images/media/team/badge/wwxuyw1448813348.png',
                'Newcastle': 'https://www.thesportsdb.com/images/media/team/badge/wwxuyw1448813348.png',
                'Nottingham Forest': 'https://www.thesportsdb.com/images/media/team/badge/uyhbfe1612467038.png',
                'Tottenham Hotspur': 'https://www.thesportsdb.com/images/media/team/badge/xxrxpu1448813232.png',
                'Tottenham': 'https://www.thesportsdb.com/images/media/team/badge/xxrxpu1448813232.png',
                'West Ham United': 'https://www.thesportsdb.com/images/media/team/badge/tpwptu1467456296.png',
                'West Ham': 'https://www.thesportsdb.com/images/media/team/badge/tpwptu1467456296.png',
                'Wolverhampton Wanderers': 'https://www.thesportsdb.com/images/media/team/badge/1yhpte1646072327.png',
                'Wolves': 'https://www.thesportsdb.com/images/media/team/badge/1yhpte1646072327.png',
                'Brentford': 'https://www.thesportsdb.com/images/media/team/badge/qtpsps1420049324.png',
                'Leicester City': 'https://www.thesportsdb.com/images/media/team/badge/uvxutp1448813130.png',
                'Sunderland': 'https://www.thesportsdb.com/images/media/team/badge/rwqrrq1448813106.png'
            };
            
            return crestUrls[teamName] || null;
        }

        // Data Loading Functions
        async function loadTeams() {
            showStatus('Loading teams...', 'loading');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/teams?select=id,name,slug,crest_url&order=name`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Teams API failed: ${response.status}`);
                }
                
                allTeams = await response.json();
                
                // Create teams lookup
                teamsMap = {};
                allTeams.forEach(team => {
                    teamsMap[team.id] = team;
                });
                
                // Populate team filter
                const teamFilter = document.getElementById('team-filter');
                teamFilter.innerHTML = '<option value="">All Teams</option>';
                allTeams.forEach(team => {
                    const option = document.createElement('option');
                    option.value = team.id;
                    option.textContent = team.name;
                    teamFilter.appendChild(option);
                });
                
                console.log('Teams loaded:', allTeams.length);
                return true;
                
            } catch (error) {
                console.error('Error loading teams:', error);
                showStatus(`Error loading teams: ${error.message}`, 'error');
                return false;
            }
        }

        async function loadFixtures() {
            showStatus('Loading fixtures...', 'loading');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/fixtures?select=id,home_team_id,away_team_id,utc_kickoff,matchweek,venue,broadcasts_uk(provider_id,channel_name,stream_type,verified,providers(display_name))&order=utc_kickoff`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Fixtures API failed: ${response.status}`);
                }
                
                allFixtures = await response.json();
                console.log('Fixtures loaded:', allFixtures.length);
                
                // Populate matchweek filter
                populateMatchweekFilter();
                
                displayFixtures();
                return true;
                
            } catch (error) {
                console.error('Error loading fixtures:', error);
                showStatus(`Error loading fixtures: ${error.message}`, 'error');
                return false;
            }
        }

        function populateMatchweekFilter() {
            const matchweekFilter = document.getElementById('matchweek-filter');
            const matchweeks = [...new Set(allFixtures.map(f => f.matchweek).filter(m => m))].sort((a, b) => a - b);
            
            matchweekFilter.innerHTML = '<option value="">All Matchweeks</option>';
            matchweeks.forEach(matchweek => {
                const option = document.createElement('option');
                option.value = matchweek;
                option.textContent = `Matchweek ${matchweek}`;
                matchweekFilter.appendChild(option);
            });
        }

        function getFilteredFixtures() {
            const teamFilter = document.getElementById('team-filter').value;
            const matchweekFilter = document.getElementById('matchweek-filter').value;
            const timeFilter = document.getElementById('time-filter').value;
            
            let filtered = allFixtures;

            // Team filter
            if (teamFilter) {
                filtered = filtered.filter(fixture => 
                    fixture.home_team_id == teamFilter || 
                    fixture.away_team_id == teamFilter
                );
            }

            // Matchweek filter
            if (matchweekFilter) {
                filtered = filtered.filter(fixture => 
                    fixture.matchweek == matchweekFilter
                );
            }

            // Time filter
            if (timeFilter === 'upcoming') {
                const now = new Date();
                filtered = filtered.filter(fixture => 
                    new Date(fixture.utc_kickoff) > now
                );
            }

            return filtered;
        }

        function groupFixtures(fixtures) {
            const groups = {};
            
            fixtures.forEach(fixture => {
                const groupKey = fixture.matchweek ? `Matchweek ${fixture.matchweek}` : 'No Matchweek';
                
                if (!groups[groupKey]) {
                    groups[groupKey] = [];
                }
                groups[groupKey].push(fixture);
            });
            
            return groups;
        }

        function renderFixture(fixture) {
            const homeTeam = teamsMap[fixture.home_team_id];
            const awayTeam = teamsMap[fixture.away_team_id];
            
            if (!homeTeam || !awayTeam) {
                return '';
            }
            
            const kickoffDate = new Date(fixture.utc_kickoff);
            const dateStr = kickoffDate.toLocaleDateString('en-GB', {
                weekday: 'short',
                day: 'numeric',
                month: 'short',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Get crest URLs with fallbacks
            const homeCrestUrl = homeTeam.crest_url || getTeamCrestUrl(homeTeam.name);
            const awayCrestUrl = awayTeam.crest_url || getTeamCrestUrl(awayTeam.name);
            const homeAbbr = getTeamAbbreviation(homeTeam.name);
            const awayAbbr = getTeamAbbreviation(awayTeam.name);
            
            // Generate match URL like backup version
            const matchSlug = `${homeTeam.name.toLowerCase().replace(/\s+/g, '-')}-vs-${awayTeam.name.toLowerCase().replace(/\s+/g, '-')}-${fixture.utc_kickoff.split('T')[0]}`;
            const href = `/football/matches/${fixture.id}-${matchSlug}`;
            
            return `
                <a class="cardlink" href="${href}">
                    <div class="fixture">
                        <div class="fixture-header">
                            <div class="fixture-teams">
                                <div class="team-badge">
                                    ${homeCrestUrl ? 
                                        `<img src="${homeCrestUrl}" alt="${homeTeam.name}" onerror="this.style.display='none'; this.nextSibling.style.display='block';">
                                         <span style="display:none">${homeAbbr}</span>` :
                                        homeAbbr
                                    }
                                </div>
                                <span>${homeTeam.name}</span>
                                <span class="vs-text">vs</span>
                                <span>${awayTeam.name}</span>
                                <div class="team-badge">
                                    ${awayCrestUrl ? 
                                        `<img src="${awayCrestUrl}" alt="${awayTeam.name}" onerror="this.style.display='none'; this.nextSibling.style.display='block';">
                                         <span style="display:none">${awayAbbr}</span>` :
                                        awayAbbr
                                    }
                                </div>
                            </div>
                            <div class="fixture-info">
                                <div class="fixture-date">${dateStr}</div>
                                ${fixture.venue ? `<div class="fixture-venue">${fixture.venue}</div>` : ''}
                            </div>
                        </div>
                        <div class="broadcasters">
                            ${renderBroadcastInfo(fixture)}
                        </div>
                    </div>
                </a>
            `;
        }

        function displayFixtures() {
            const fixturesContainer = document.getElementById('fixtures-container');
            const filtered = getFilteredFixtures();
            
            if (filtered.length === 0) {
                fixturesContainer.innerHTML = '<div class="no-fixtures">No fixtures found matching your filters.</div>';
                hideStatus();
                return;
            }
            
            const grouped = groupFixtures(filtered);
            
            let html = '';
            
            Object.entries(grouped).forEach(([groupName, fixtures]) => {
                html += `
                    <div class="matchweek-group">
                        <div class="matchweek-header">${groupName}</div>
                        <div class="matchweek-fixtures">
                `;
                
                fixtures.forEach(fixture => {
                    html += renderFixture(fixture);
                });
                
                html += '</div></div>';
            });
            
            fixturesContainer.innerHTML = html;
            showStatus(`Showing ${filtered.length} fixtures`, 'success');
            
            // Hide status after 2 seconds
            setTimeout(hideStatus, 2000);
        }


        // Event Listeners
        document.getElementById('team-filter').addEventListener('change', displayFixtures);
        document.getElementById('matchweek-filter').addEventListener('change', displayFixtures);
        document.getElementById('time-filter').addEventListener('change', displayFixtures);

        // Initialize App
        async function initApp() {
            try {
                const teamsLoaded = await loadTeams();
                if (teamsLoaded) {
                    const fixturesLoaded = await loadFixtures();
                    if (fixturesLoaded) {
                        console.log('App initialized successfully');
                    }
                }
            } catch (error) {
                console.error('Failed to initialize app:', error);
                showStatus('Failed to load fixtures. Please refresh the page.', 'error');
            }
        }

        // ---- Routing System (from backup-index.html) ----
        const routes = { "/": homeView, "/fixtures": fixturesView, "/match": matchView, "/clubs": clubsView, "/club": clubPageView };
        const APP_BASE = '/football';

        function parseRoute(){
            let p = location.pathname;
            const searchParams = new URLSearchParams(location.search);
            if (!p.startsWith(APP_BASE)) return { path:'/', params:new URLSearchParams(searchParams) };
            const parts = p.slice(APP_BASE.length).replace(/^\/+/, '').split('/').filter(Boolean);
            
            if (parts.length === 0) return { path:'/', params:new URLSearchParams(searchParams) };
            if (parts[0] === 'fixtures') return { path:'/fixtures', params:new URLSearchParams(searchParams) };
            if (parts[0] === 'clubs' && parts.length === 1) return { path:'/clubs', params:new URLSearchParams(searchParams) };
            if (parts[0] === 'clubs' && parts[1]){
                const mergedClub = new URLSearchParams(searchParams); 
                mergedClub.set('slug', parts[1]);
                return { path:'/club', params: mergedClub };
            }
            if (parts[0] === 'matches' && parts[1]){
                const m = /^(\d+)/.exec(parts[1]);
                const id = m ? m[1] : parts[1];
                const mergedMatch = new URLSearchParams(searchParams); 
                mergedMatch.set('id', id);
                return { path:'/match', params: mergedMatch };
            }
            return { path:'/', params:new URLSearchParams(searchParams) };
        }

        function navigate(to){
            const href = to.startsWith('/') ? to : APP_BASE + '/' + to;
            if (location.pathname + location.search !== href){
                history.pushState(null, '', href);
                render();
            }
        }

        // Intercept internal links to use the History API
        document.addEventListener('click', (e)=>{
            const a = e.target.closest('a');
            if (!a) return;
            const href = a.getAttribute('href') || '';
            const isInternal = href.startsWith(APP_BASE) || href.startsWith('/');
            if (!isInternal || a.origin !== location.origin) return;
            if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey || a.target === '_blank') return;
            e.preventDefault();
            navigate(href);
        });

        window.addEventListener('popstate', () => {
            render();
        });

        function updateFiltersVisibility(currentPath) {
            const filtersDiv = document.querySelector(".filters");
            if (filtersDiv) {
                // Only show filters on fixtures page
                if (currentPath === '/fixtures') {
                    filtersDiv.style.display = "block";
                } else {
                    filtersDiv.style.display = "none";
                }
            }
        }

        function updateNavigationActiveStates(currentPath) {
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (href === '/football' && currentPath === '/') {
                    // Home is active
                    link.className = 'btn btn--primary';
                } else if (href === '/football/fixtures' && currentPath === '/fixtures') {
                    // Fixtures is active
                    link.className = 'btn btn--primary';
                } else if (href === '/football/clubs' && currentPath === '/clubs') {
                    // Clubs is active
                    link.className = 'btn btn--primary';
                } else {
                    // Not active
                    link.className = 'btn btn--broadcaster';
                }
            });
        }

        async function render(){
            const { path, params } = parseRoute();
            const view = routes[path] || homeView;
            
            // Update navigation active states and filter visibility
            updateNavigationActiveStates(path);
            updateFiltersVisibility(path);
            
            showStatus('Loading...', 'loading');
            try { 
                await view(params); 
            } catch(e){
                console.error(e);
                document.getElementById("fixtures-container").innerHTML = `<p class="muted">${e.message}</p>`;
            } finally { 
                hideStatus(); 
            }
        }

        // Global variables for lazy loading
        let currentMatchweek = null;
        let allMatchweeks = [];
        let isLoading = false;
        
        // Views
        async function homeView(params){
            // Hide filters for home view - we want a clean main page
            const filtersDiv = document.querySelector(".filters");
            if (filtersDiv) {
                filtersDiv.style.display = "none";
            }
            
            const container = document.getElementById("fixtures-container");
            
            try {
                // Load upcoming fixtures
                const nowIso = new Date().toISOString();
                const fixturesResponse = await fetch(`${SUPABASE_URL}/rest/v1/fixtures?utc_kickoff=gte.${nowIso}&select=id,home_team_id,away_team_id,utc_kickoff,matchweek,venue,broadcasts_uk(provider_id,channel_name,stream_type,verified,providers(display_name))&order=utc_kickoff&limit=100`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!fixturesResponse.ok) {
                    throw new Error(`Failed to load fixtures: ${fixturesResponse.status}`);
                }
                
                const fixtures = await fixturesResponse.json();
                
                // Load teams data
                await loadTeamsForHome();
                
                // Group fixtures by matchweek
                const groupedByMatchweek = {};
                fixtures.forEach(fixture => {
                    const mw = fixture.matchweek || 'Unknown';
                    if (!groupedByMatchweek[mw]) {
                        groupedByMatchweek[mw] = [];
                    }
                    groupedByMatchweek[mw].push(fixture);
                });
                
                // Get sorted matchweeks
                allMatchweeks = Object.keys(groupedByMatchweek).sort((a, b) => {
                    if (a === 'Unknown') return 1;
                    if (b === 'Unknown') return -1;
                    return parseInt(a) - parseInt(b);
                });
                
                // Show only the first (current/upcoming) matchweek
                currentMatchweek = 0;
                
                if (allMatchweeks.length > 0) {
                    const firstMatchweek = allMatchweeks[0];
                    const matchweekFixtures = groupedByMatchweek[firstMatchweek];
                    
                    container.innerHTML = renderMatchweekCard(firstMatchweek, matchweekFixtures);
                    
                    // Add scroll indicator if there are more matchweeks
                    if (allMatchweeks.length > 1) {
                        addScrollIndicator();
                        setupLazyLoading(groupedByMatchweek);
                    }
                } else {
                    container.innerHTML = `<div class="no-fixtures">No upcoming fixtures found.</div>`;
                }
                
            } catch (error) {
                console.error('Error loading home page:', error);
                container.innerHTML = `<div class="no-fixtures">Error loading fixtures: ${error.message}</div>`;
            }
        }
        
        async function loadTeamsForHome() {
            if (Object.keys(teamsMap).length > 0) return; // Already loaded
            
            const teamsResponse = await fetch(`${SUPABASE_URL}/rest/v1/teams?select=id,name,slug,crest_url&order=name`, {
                headers: {
                    'apikey': SUPABASE_ANON_KEY,
                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                }
            });
            
            if (teamsResponse.ok) {
                const teams = await teamsResponse.json();
                teamsMap = {};
                teams.forEach(team => {
                    teamsMap[team.id] = team;
                });
            }
        }
        
        function renderMatchweekCard(matchweek, fixtures) {
            // Group fixtures by day within this matchweek
            const groupedByDay = {};
            fixtures.forEach(fixture => {
                const date = new Date(fixture.utc_kickoff);
                const dayKey = date.toLocaleDateString('en-GB', {
                    weekday: 'long',
                    day: 'numeric', 
                    month: 'long'
                });
                
                if (!groupedByDay[dayKey]) {
                    groupedByDay[dayKey] = [];
                }
                groupedByDay[dayKey].push(fixture);
            });
            
            const dayGroups = Object.entries(groupedByDay)
                .sort(([,a], [,b]) => new Date(a[0].utc_kickoff) - new Date(b[0].utc_kickoff))
                .map(([dayKey, dayFixtures]) => {
                    const fixtureCards = dayFixtures.map(fixture => renderFixtureCard(fixture)).join('');
                    return `
                        <div class="day-group">
                            <div class="flex flex--center mb-md">
                                <h3 class="text-lg font-semibold text-primary" style="margin: 0;">${dayKey}</h3>
                                <div style="flex: 1; height: 2px; background: linear-gradient(90deg, var(--border-color) 0%, transparent 100%); margin-left: var(--spacing-md); border-radius: 1px;"></div>
                            </div>
                            <div class="day-fixtures" style="margin-top: 1rem;">
                                ${fixtureCards}
                            </div>
                        </div>
                    `;
                }).join('');
            
            return `
                <div class="card card--featured mb-lg">
                    <div class="flex flex--between flex--center mb-lg" style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%); margin: calc(var(--spacing-lg) * -1) calc(var(--spacing-lg) * -1) var(--spacing-lg); padding: var(--spacing-lg); border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;">
                        <h2 class="text-2xl font-bold" style="margin: 0; color: var(--text-inverse);">
                            ${matchweek !== 'Unknown' ? `Matchweek ${matchweek}` : 'Upcoming Fixtures'}
                        </h2>
                        <div class="btn btn--broadcaster" style="background: rgba(255, 255, 255, 0.2); color: var(--text-inverse); border: 1px solid rgba(255, 255, 255, 0.2);">
                            ${fixtures.length} matches
                        </div>
                    </div>
                    ${dayGroups}
                </div>
            `;
        }
        
        function renderMatchBroadcastInfo(fixture) {
            if (!fixture.broadcasts_uk || fixture.broadcasts_uk.length === 0) {
                return `
                    <div class="card" style="padding: 1.5rem; background: rgba(0, 0, 0, 0.05); border: 1px solid rgba(0, 0, 0, 0.2); border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 0.75rem; color: #000000;">
                            <span style="font-size: 1.25rem;">📵</span>
                            <div>
                                <div style="font-weight: 600; font-size: 1rem;">Blackout</div>
                                <div style="font-size: 0.875rem; margin-top: 0.25rem; color: #4a4a4a;">Not available on UK TV (3pm Saturday blackout)</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            const broadcasts = fixture.broadcasts_uk.filter(broadcast => broadcast.providers && broadcast.providers.display_name);
            
            if (broadcasts.length === 0) {
                return `
                    <div class="card" style="padding: 1.5rem; background: rgba(0, 0, 0, 0.05); border: 1px solid rgba(0, 0, 0, 0.2); border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 0.75rem; color: #000000;">
                            <span style="font-size: 1.25rem;">📵</span>
                            <div>
                                <div style="font-weight: 600; font-size: 1rem;">Blackout</div>
                                <div style="font-size: 0.875rem; margin-top: 0.25rem; color: #4a4a4a;">Not available on UK TV (3pm Saturday blackout)</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            const getBroadcasterCardStyle = (broadcaster) => {
                const baseName = broadcaster.toLowerCase();
                if (baseName.includes('tnt')) {
                    return {
                        background: "linear-gradient(135deg, rgba(220, 38, 38, 0.05) 0%, rgba(248, 113, 113, 0.05) 100%)",
                        border: "1px solid rgba(220, 38, 38, 0.2)",
                        iconColor: "#dc2626"
                    };
                } else if (baseName.includes('sky')) {
                    return {
                        background: "linear-gradient(135deg, rgba(37, 99, 235, 0.05) 0%, rgba(96, 165, 250, 0.05) 100%)",
                        border: "1px solid rgba(37, 99, 235, 0.2)",
                        iconColor: "#2563eb"
                    };
                } else {
                    return {
                        background: "linear-gradient(135deg, rgba(107, 114, 128, 0.02) 0%, rgba(156, 163, 175, 0.02) 100%)",
                        border: "1px solid rgba(107, 114, 128, 0.1)",
                        iconColor: "#6b7280"
                    };
                }
            };

            const broadcasterCards = broadcasts.map(broadcast => {
                const style = getBroadcasterCardStyle(broadcast.providers.display_name);
                return `
                    <div class="card" style="padding: 1.25rem; background: ${style.background}; border: ${style.border}; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 1.25rem; color: ${style.iconColor};">📡</span>
                            <div>
                                <div style="font-weight: 600; font-size: 1rem; color: #1f2937;">${broadcast.providers.display_name}</div>
                                ${broadcast.channel_name ? `<div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">${broadcast.channel_name}</div>` : ''}
                                ${broadcast.stream_type ? `<div style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.25rem;">${broadcast.stream_type}</div>` : ''}
                                ${broadcast.verified ? 
                                    '<div style="font-size: 0.75rem; color: #10b981; margin-top: 0.5rem;">✅ Verified</div>' : 
                                    '<div style="font-size: 0.75rem; color: #f59e0b; margin-top: 0.5rem;">⚠️ Unverified</div>'
                                }
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div style="display: grid; gap: 1rem;">
                    ${broadcasterCards}
                </div>
            `;
        }

        function renderBroadcastInfo(fixture) {
            if (!fixture.broadcasts_uk || fixture.broadcasts_uk.length === 0) {
                return `
                    <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(226, 232, 240, 0.5);">
                        <div style="display: inline-block; padding: 0.25rem 0.75rem; background: rgba(0, 0, 0, 0.8); color: #ffffff; font-size: 0.75rem; border-radius: 12px; font-weight: 500;">
                            Blackout
                        </div>
                    </div>
                `;
            }

            const broadcasters = fixture.broadcasts_uk
                .filter(broadcast => broadcast.providers && broadcast.providers.display_name)
                .map(broadcast => broadcast.providers.display_name)
                .filter((name, index, self) => self.indexOf(name) === index); // Remove duplicates

            if (broadcasters.length === 0) {
                return `
                    <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(226, 232, 240, 0.5);">
                        <div style="display: inline-block; padding: 0.25rem 0.75rem; background: rgba(0, 0, 0, 0.8); color: #ffffff; font-size: 0.75rem; border-radius: 12px; font-weight: 500;">
                            Blackout
                        </div>
                    </div>
                `;
            }

            const getBroadcasterButtonStyle = (broadcaster) => {
                let baseStyle = "padding: 0.25rem 0.75rem; font-size: 0.75rem; border-radius: 12px; margin-right: 0.5rem; margin-bottom: 0.25rem; border: none; font-weight: 500;";
                
                if (broadcaster.toLowerCase().includes('tnt')) {
                    return baseStyle + " background: #dc2626; color: #ffffff;";
                } else if (broadcaster.toLowerCase().includes('sky')) {
                    return baseStyle + " background: #2563eb; color: #ffffff;";
                } else {
                    return baseStyle + " background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color);";
                }
            };

            const broadcasterButtons = broadcasters.map(broadcaster => `
                <button style="${getBroadcasterButtonStyle(broadcaster)}" onclick="event.preventDefault(); event.stopPropagation();">
                    ${broadcaster}
                </button>
            `).join('');

            return `
                <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(226, 232, 240, 0.5);">
                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                        ${broadcasterButtons}
                    </div>
                </div>
            `;
        }

        function renderFixtureCard(fixture) {
            const homeTeam = teamsMap[fixture.home_team_id];
            const awayTeam = teamsMap[fixture.away_team_id];
            
            if (!homeTeam || !awayTeam) return '';
            
            const kickoffDate = new Date(fixture.utc_kickoff);
            const timeStr = kickoffDate.toLocaleTimeString('en-GB', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const homeCrestUrl = homeTeam.crest_url || getTeamCrestUrl(homeTeam.name);
            const awayCrestUrl = awayTeam.crest_url || getTeamCrestUrl(awayTeam.name);
            const homeAbbr = getTeamAbbreviation(homeTeam.name);
            const awayAbbr = getTeamAbbreviation(awayTeam.name);
            
            const matchSlug = `${homeTeam.name.toLowerCase().replace(/\s+/g, '-')}-vs-${awayTeam.name.toLowerCase().replace(/\s+/g, '-')}-${fixture.utc_kickoff.split('T')[0]}`;
            const href = `/football/matches/${fixture.id}-${matchSlug}`;
            
            return `
                <a class="cardlink" href="${href}">
                    <div class="card card--match" style="border: 1px solid rgba(226, 232, 240, 0.8); border-radius: 12px; padding: 1.25rem; margin-bottom: 0.75rem; background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); backdrop-filter: blur(10px); cursor: pointer;" 
                         onmouseover="this.style.background='linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 197, 253, 0.05) 100%)'; this.style.transform='translateY(-3px) scale(1.01)'; this.style.boxShadow='0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)'; this.style.borderColor='rgba(59, 130, 246, 0.3)'" 
                         onmouseout="this.style.background='linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%)'; this.style.transform=''; this.style.boxShadow=''; this.style.borderColor='rgba(226, 232, 240, 0.8)'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; min-width: 120px;">
                                    <div class="team-badge" style="width: 24px; height: 24px;">
                                        ${homeCrestUrl ? 
                                            `<img src="${homeCrestUrl}" alt="${homeTeam.name}" style="width: 100%; height: 100%; object-fit: contain;" onerror="this.style.display='none'; this.nextSibling.style.display='block';">
                                             <span style="display:none; font-size: 0.7rem; font-weight: bold;">${homeAbbr}</span>` :
                                            `<span style="font-size: 0.7rem; font-weight: bold;">${homeAbbr}</span>`
                                        }
                                    </div>
                                    <span style="font-weight: 600; font-size: 0.9rem;">${homeTeam.name}</span>
                                </div>
                                
                                <div style="color: #9ca3af; font-size: 0.8rem; margin: 0 0.5rem;">vs</div>
                                
                                <div style="display: flex; align-items: center; gap: 0.5rem; min-width: 120px;">
                                    <span style="font-weight: 600; font-size: 0.9rem;">${awayTeam.name}</span>
                                    <div class="team-badge" style="width: 24px; height: 24px;">
                                        ${awayCrestUrl ? 
                                            `<img src="${awayCrestUrl}" alt="${awayTeam.name}" style="width: 100%; height: 100%; object-fit: contain;" onerror="this.style.display='none'; this.nextSibling.style.display='block';">
                                             <span style="display:none; font-size: 0.7rem; font-weight: bold;">${awayAbbr}</span>` :
                                            `<span style="font-size: 0.7rem; font-weight: bold;">${awayAbbr}</span>`
                                        }
                                    </div>
                                </div>
                            </div>
                            
                            <div style="text-align: right; color: #6b7280; font-size: 0.9rem;">
                                <div style="font-weight: 600;">${timeStr}</div>
                                ${fixture.venue ? `<div style="font-size: 0.75rem; margin-top: 0.25rem;">${fixture.venue}</div>` : ''}
                            </div>
                        </div>
                        ${renderBroadcastInfo(fixture)}
                    </div>
                </a>
            `;
        }
        
        function addScrollIndicator() {
            const container = document.getElementById("fixtures-container");
            const indicator = document.createElement('div');
            indicator.id = 'scroll-indicator';
            indicator.innerHTML = `
                <div style="text-align: center; padding: 3rem; background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(248, 250, 252, 0.8) 100%); border-radius: 16px; margin-top: 2rem; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
                    <div style="display: inline-flex; align-items: center; gap: 0.75rem; font-size: 0.95rem; color: #64748b; font-weight: 500;">
                        <span>Scroll for more matchweeks</span>
                        <div style="width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 8px solid #64748b; animation: bounce 2s infinite; opacity: 0.7;"></div>
                    </div>
                </div>
                <style>
                    @keyframes bounce {
                        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                        40% { transform: translateY(-5px); }
                        60% { transform: translateY(-3px); }
                    }
                </style>
            `;
            container.appendChild(indicator);
        }
        
        function setupLazyLoading(groupedByMatchweek) {
            let lastScrollTop = 0;
            
            window.addEventListener('scroll', () => {
                if (isLoading) return;
                
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                
                // Check if we're near the bottom and scrolling down
                if (scrollTop > lastScrollTop && scrollTop + windowHeight >= documentHeight - 100) {
                    loadNextMatchweek(groupedByMatchweek);
                }
                
                lastScrollTop = scrollTop;
            });
        }
        
        function loadNextMatchweek(groupedByMatchweek) {
            if (isLoading || currentMatchweek >= allMatchweeks.length - 1) return;
            
            isLoading = true;
            currentMatchweek++;
            
            const nextMatchweek = allMatchweeks[currentMatchweek];
            const matchweekFixtures = groupedByMatchweek[nextMatchweek];
            
            const container = document.getElementById("fixtures-container");
            const indicator = document.getElementById('scroll-indicator');
            
            // Remove the scroll indicator temporarily
            if (indicator) indicator.style.display = 'none';
            
            // Add the new matchweek card
            const newCard = document.createElement('div');
            newCard.innerHTML = renderMatchweekCard(nextMatchweek, matchweekFixtures);
            container.appendChild(newCard.firstElementChild);
            
            // Show indicator again if there are more matchweeks
            if (currentMatchweek < allMatchweeks.length - 1) {
                if (indicator) indicator.style.display = 'block';
            } else {
                if (indicator) indicator.remove();
            }
            
            setTimeout(() => {
                isLoading = false;
            }, 500);
        }

        async function fixturesView(params){
            // Show filters for fixtures view  
            const filtersDiv = document.querySelector(".filters");
            if (filtersDiv) {
                filtersDiv.style.display = "block";
            }
            // Use existing functionality for fixtures view
            await initApp();
        }

        async function clubsView(params){
            // Hide filters for clubs view
            const filtersDiv = document.querySelector(".filters");
            if (filtersDiv) {
                filtersDiv.style.display = "none";
            }
            
            const container = document.getElementById("fixtures-container");
            
            try {
                // Load only current Premier League teams (exclude Championship teams)
                // Exclude teams that are not in this season's Premier League  
                const excludedTeams = ['Leicester City', 'Southampton', 'Leeds United', 'Burnley', 'Sunderland'];
                const teamsResponse = await fetch(`${SUPABASE_URL}/rest/v1/teams?select=id,name,slug,crest_url&order=name&name=not.in.%28Leicester+City%2CSouthampton%2CLeeds+United%2CBurnley%2CSunderland%29`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!teamsResponse.ok) {
                    throw new Error(`Failed to load teams: ${teamsResponse.status}`);
                }
                
                const teams = await teamsResponse.json();
                
                const clubsGrid = teams.map(team => {
                    const crestUrl = team.crest_url || getTeamCrestUrl(team.name);
                    return `
                        <a href="/football/clubs/${team.slug}" style="text-decoration: none; color: inherit;">
                            <div style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 1rem; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.06); transition: transform 0.2s, box-shadow 0.2s; text-align: center; min-height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;" 
                                 onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" 
                                 onmouseout="this.style.transform=''; this.style.boxShadow='0 1px 3px rgba(0,0,0,0.06)'">
                                ${crestUrl ? `<img src="${crestUrl}" alt="${team.name} badge" style="width: 36px; height: 36px; object-fit: contain;">` : ''}
                                <strong style="font-size: 0.9rem; line-height: 1.2;">${team.name}</strong>
                            </div>
                        </a>
                    `;
                }).join('');
                
                container.innerHTML = `
                    <div class="card mb-lg">
                        <h2 class="text-2xl font-semibold mb-lg">Premier League Clubs</h2>
                        <div class="grid grid--2">
                            ${clubsGrid}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading clubs:', error);
                container.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                        <h2 style="margin: 0 0 1rem 0;">Error Loading Clubs</h2>
                        <p class="muted">Failed to load club information. Please try again.</p>
                    </div>
                `;
            }
        }

        async function clubPageView(params){
            // Hide filters for individual club page
            const filtersDiv = document.querySelector(".filters");
            if (filtersDiv) {
                filtersDiv.style.display = "none";
            }
            
            const container = document.getElementById("fixtures-container");
            const slug = params.get('slug');
            if (!slug) {
                container.innerHTML = '<p class="muted">Club not found.</p>';
                return;
            }
            
            try {
                // Load team details
                const teamResponse = await fetch(`${SUPABASE_URL}/rest/v1/teams?slug=eq.${encodeURIComponent(slug)}&select=id,name,slug,crest_url`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!teamResponse.ok) {
                    throw new Error(`Failed to load team: ${teamResponse.status}`);
                }
                
                const teams = await teamResponse.json();
                const team = teams[0];
                
                if (!team) {
                    container.innerHTML = `
                        <div style="background: white; padding: 2rem; border-radius: 8px;">
                            <a href="/football/clubs" style="color: #7f8c8d; text-decoration: none;">← Back to clubs</a>
                            <p class="muted" style="margin-top: 1rem;">Club not found.</p>
                        </div>
                    `;
                    return;
                }
                
                // Load upcoming fixtures for this team
                const nowIso = new Date().toISOString();
                const fixturesResponse = await fetch(`${SUPABASE_URL}/rest/v1/fixtures?or=(home_team_id.eq.${team.id},away_team_id.eq.${team.id})&utc_kickoff=gte.${nowIso}&select=id,home_team_id,away_team_id,utc_kickoff,venue,broadcasts_uk(provider_id,channel_name,stream_type,verified,providers(display_name))&order=utc_kickoff&limit=10`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                const fixtures = fixturesResponse.ok ? await fixturesResponse.json() : [];
                
                // Load team names for opponents
                let allTeamIds = [];
                fixtures.forEach(f => {
                    if (f.home_team_id !== team.id) allTeamIds.push(f.home_team_id);
                    if (f.away_team_id !== team.id) allTeamIds.push(f.away_team_id);
                });
                
                let opponentTeams = {};
                if (allTeamIds.length > 0) {
                    const opponentsResponse = await fetch(`${SUPABASE_URL}/rest/v1/teams?id=in.(${allTeamIds.join(',')})&select=id,name,crest_url`, {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    });
                    if (opponentsResponse.ok) {
                        const opponents = await opponentsResponse.json();
                        opponentTeams = Object.fromEntries(opponents.map(t => [t.id, t]));
                    }
                }
                
                const crestUrl = team.crest_url || getTeamCrestUrl(team.name);
                
                const fixturesList = fixtures.length > 0 ? fixtures.map(fixture => {
                    const isHome = fixture.home_team_id === team.id;
                    const opponentId = isHome ? fixture.away_team_id : fixture.home_team_id;
                    const opponent = opponentTeams[opponentId];
                    
                    if (!opponent) return '';
                    
                    const kickoffDate = new Date(fixture.utc_kickoff);
                    const dateStr = kickoffDate.toLocaleDateString('en-GB', {
                        weekday: 'short',
                        day: 'numeric',
                        month: 'short',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const matchSlug = `${isHome ? team.name : opponent.name}-vs-${isHome ? opponent.name : team.name}-${fixture.utc_kickoff.split('T')[0]}`.toLowerCase().replace(/\s+/g, '-');
                    const href = `/football/matches/${fixture.id}-${matchSlug}`;
                    
                    const opponentCrest = opponent.crest_url || getTeamCrestUrl(opponent.name);
                    
                    return `
                        <a href="${href}" style="text-decoration: none; color: inherit;">
                            <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; background: white; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f9fafb'" onmouseout="this.style.backgroundColor='white'">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        ${opponentCrest ? `<img src="${opponentCrest}" alt="${opponent.name} badge" style="width: 24px; height: 24px; object-fit: contain;">` : ''}
                                        <strong>${opponent.name}</strong>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 0.9rem; color: #7f8c8d;">${dateStr}</div>
                                        <div style="font-size: 0.8rem; color: #9ca3af; margin-top: 2px;">${isHome ? 'Home' : 'Away'}</div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    `;
                }).filter(Boolean).join('') : '<p class="muted">No upcoming fixtures.</p>';
                
                container.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                        <a href="/football/clubs" style="color: #7f8c8d; text-decoration: none;">← Back to clubs</a>
                        <div style="display: flex; align-items: center; gap: 12px; margin: 1.5rem 0;">
                            ${crestUrl ? `<img src="${crestUrl}" alt="${team.name} badge" style="width: 48px; height: 48px; object-fit: contain;">` : ''}
                            <h1 style="margin: 0; font-size: 2rem;">${team.name}</h1>
                        </div>
                        <h3 style="margin: 1.5rem 0 1rem 0;">Upcoming Fixtures</h3>
                        ${fixturesList}
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading club page:', error);
                container.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px;">
                        <a href="/football/clubs" style="color: #7f8c8d; text-decoration: none;">← Back to clubs</a>
                        <h2 style="margin: 1rem 0;">Error Loading Club</h2>
                        <p class="muted">Failed to load club information. Please try again.</p>
                    </div>
                `;
            }
        }

        async function matchView(params){
            // Hide filters on match page
            const filtersDiv = document.querySelector(".filters");
            if (filtersDiv) {
                filtersDiv.style.display = "none";
            }
            
            const container = document.getElementById("fixtures-container");
            const id = params.get("id");
            if (!id){ 
                container.innerHTML = `<p class="muted">Match not found. <a href="/football">Go back</a></p>`; 
                return; 
            }
            
            try {
                // Load fixture details
                const fixtureResponse = await fetch(`${SUPABASE_URL}/rest/v1/fixtures?id=eq.${id}&select=id,home_team_id,away_team_id,utc_kickoff,venue,broadcasts_uk(provider_id,channel_name,stream_type,verified,providers(display_name))`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!fixtureResponse.ok) {
                    throw new Error(`Failed to load fixture: ${fixtureResponse.status}`);
                }
                
                const fixtures = await fixtureResponse.json();
                const fixture = fixtures[0];
                
                if (!fixture) {
                    container.innerHTML = `<p class="muted">Fixture not found. <a href="/football">Home</a></p>`;
                    return;
                }
                
                // Load team details
                const teamIds = [fixture.home_team_id, fixture.away_team_id].join(',');
                const teamsResponse = await fetch(`${SUPABASE_URL}/rest/v1/teams?id=in.(${teamIds})&select=id,name,slug,crest_url`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!teamsResponse.ok) {
                    throw new Error(`Failed to load teams: ${teamsResponse.status}`);
                }
                
                const teams = await teamsResponse.json();
                const tById = Object.fromEntries(teams.map(t => [t.id, t.name]));
                const crestById = Object.fromEntries(teams.map(t => [t.id, t.crest_url || getTeamCrestUrl(t.name)]));
                
                // Format date and time
                const kickoffDate = new Date(fixture.utc_kickoff);
                const dateStr = kickoffDate.toLocaleDateString('en-GB', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Build match header with team crests and names
                const homeTeam = tById[fixture.home_team_id];
                const awayTeam = tById[fixture.away_team_id];
                const homeCrest = crestById[fixture.home_team_id];
                const awayCrest = crestById[fixture.away_team_id];
                
                container.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                        <a href="/football" style="color: #7f8c8d; text-decoration: none;">← Back</a>
                        <h1 style="margin: 1rem 0; display: flex; align-items: center; gap: 12px; font-size: 2rem;">
                            ${homeCrest ? `<img style="width: 48px; height: 48px; object-fit: contain;" alt="${homeTeam} badge" src="${homeCrest}">` : ''}
                            ${homeTeam} vs ${awayTeam}
                            ${awayCrest ? `<img style="width: 48px; height: 48px; object-fit: contain;" alt="${awayTeam} badge" src="${awayCrest}">` : ''}
                        </h1>
                        <div style="color: #7f8c8d; font-size: 1.1rem; margin-bottom: 2rem;">
                            ${dateStr}${fixture.venue ? ` — ${fixture.venue}` : ''}
                        </div>
                        <div id="broadcast-info">
                            <h3 style="margin: 1.5rem 0 1rem 0;">Where to Watch</h3>
                            ${renderMatchBroadcastInfo(fixture)}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading match details:', error);
                container.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                        <a href="/football" style="color: #7f8c8d; text-decoration: none;">← Back to fixtures</a>
                        <h2 style="margin: 1rem 0;">Error Loading Match</h2>
                        <p class="muted">Failed to load match details. Please try again.</p>
                        <p class="muted">Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function loadBroadcastInfo(fixtureId) {
            const broadcastDiv = document.getElementById("broadcast-info");
            if (!broadcastDiv) return;
            
            try {
                // Try to load broadcasts
                const response = await fetch(`${SUPABASE_URL}/rest/v1/broadcasts_uk?fixture_id=eq.${fixtureId}&select=*`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (response.ok) {
                    const broadcasts = await response.json();
                    
                    if (broadcasts && broadcasts.length > 0) {
                        broadcastDiv.innerHTML = `
                            <h3 class="text-xl font-semibold mb-md">Where to Watch</h3>
                            <div class="grid">
                                ${broadcasts.map(b => `
                                    <div class="card mb-sm">
                                        <div class="font-medium">${b.provider_name || 'TBC'}${b.channel_name ? ` — ${b.channel_name}` : ''}</div>
                                        <div class="text-sm text-secondary mt-sm">${b.stream_type || 'TV'}</div>
                                        ${b.verified ? 
                                            '<div class="text-sm mt-sm" style="color: var(--success-color);">✅ Verified</div>' : 
                                            '<div class="text-sm mt-sm" style="color: var(--warning-color);">⚠️ Unverified</div>'
                                        }
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        broadcastDiv.innerHTML = `
                            <h3 class="text-xl font-semibold mb-md">Where to Watch</h3>
                            <div class="card text-muted">
                                No UK broadcaster information available yet.
                            </div>
                        `;
                    }
                } else {
                    throw new Error(`Broadcasts API failed: ${response.status}`);
                }
            } catch (error) {
                console.error('Error loading broadcasts:', error);
                broadcastDiv.innerHTML = `
                    <h3 class="text-xl font-semibold mb-md">Where to Watch</h3>
                    <div class="card text-muted">
                        Broadcaster information will be added closer to match time.
                    </div>
                `;
            }
        }

        // Start the app with routing
        document.addEventListener('DOMContentLoaded', () => {
            render();
        });
    </script>
</body>
</html>