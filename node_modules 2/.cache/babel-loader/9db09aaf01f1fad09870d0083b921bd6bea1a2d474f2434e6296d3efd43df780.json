{"ast":null,"code":"import { createClient } from '@supabase/supabase-js';\n\n// Get credentials from environment variables with fallbacks\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL || 'https://nkfuzkrazehjivzmdrvt.supabase.co';\nconst supabaseAnonKey = process.env.REACT_APP_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rZnV6a3JhemVoaml2em1kcnZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyNjI5MzAsImV4cCI6MjA3MjgzODkzMH0.CNW1EUtcC4JWfDy-WzOIVDfv7rnXzsz1qqQyRTZVyXU';\n\n// Log a warning if using fallback credentials\nif (!process.env.REACT_APP_SUPABASE_URL || !process.env.REACT_APP_SUPABASE_ANON_KEY) {\n  console.warn('[Supabase Simple] Using fallback credentials. Consider setting REACT_APP_SUPABASE_URL and REACT_APP_SUPABASE_ANON_KEY in your .env file.');\n}\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n// Simple, minimal types\n\n// Only Sky Sports and TNT Sports for simplicity\nexport const SIMPLE_BROADCASTERS = [{\n  id: 1,\n  name: 'Sky Sports'\n}, {\n  id: 2,\n  name: 'TNT Sports'\n}];\n\n// Get fixtures with basic team info using simple JOINs\nexport async function getSimpleFixtures() {\n  try {\n    console.log('[Supabase] Loading full season fixtures (no JOINs)...');\n\n    // Step 1: Load fixture basics only\n    // Use a dynamic season start (Aug 1 of current season year)\n    const now = new Date();\n    const seasonYear = now.getUTCMonth() >= 6 ? now.getUTCFullYear() : now.getUTCFullYear() - 1;\n    const seasonStartIso = `${seasonYear}-08-01T00:00:00.000Z`;\n    const {\n      data: fixtures,\n      error\n    } = await supabase.from('fixtures').select('id, utc_kickoff, home_team_id, away_team_id').gte('utc_kickoff', seasonStartIso).order('utc_kickoff', {\n      ascending: true\n    });\n    if (error) {\n      console.error('[Supabase] Error loading fixtures:', error);\n      throw error;\n    }\n    if (!fixtures || fixtures.length === 0) {\n      console.warn('[Supabase] No fixtures returned');\n      return [];\n    }\n\n    // Step 2: Load team names in one query\n    const teamIds = Array.from(new Set([...fixtures.map(f => f.home_team_id), ...fixtures.map(f => f.away_team_id)].filter(Boolean)));\n    let teamNameById = {};\n    if (teamIds.length > 0) {\n      const {\n        data: teams,\n        error: teamError\n      } = await supabase.from('teams').select('id, name').in('id', teamIds);\n      if (teamError) {\n        console.warn('[Supabase] Error loading teams:', teamError);\n      } else {\n        (teams || []).forEach(t => {\n          teamNameById[t.id] = t.name;\n        });\n      }\n    }\n\n    // Step 3: Load broadcasts for these fixtures\n    const fixtureIds = fixtures.map(f => f.id);\n    const {\n      data: broadcasts\n    } = await supabase.from('broadcasts').select('fixture_id, provider_id').in('fixture_id', fixtureIds);\n    const broadcastLookup = {};\n    (broadcasts || []).forEach(b => {\n      broadcastLookup[b.fixture_id] = b.provider_id;\n    });\n\n    // Step 4: Map to simple format\n    return fixtures.map(fixture => {\n      var _SIMPLE_BROADCASTERS$;\n      return {\n        id: fixture.id,\n        kickoff_utc: fixture.utc_kickoff,\n        home_team: teamNameById[fixture.home_team_id] || 'Unknown',\n        away_team: teamNameById[fixture.away_team_id] || 'Unknown',\n        broadcaster: ((_SIMPLE_BROADCASTERS$ = SIMPLE_BROADCASTERS.find(b => b.id === broadcastLookup[fixture.id])) === null || _SIMPLE_BROADCASTERS$ === void 0 ? void 0 : _SIMPLE_BROADCASTERS$.name) || undefined\n      };\n    });\n  } catch (error) {\n    console.error('[Supabase] Unexpected error:', error);\n    return [];\n  }\n}\n\n// Save broadcaster assignment (simple)\nexport async function saveBroadcaster(fixtureId, providerId) {\n  try {\n    console.log(`[Supabase] Saving broadcaster for fixture ${fixtureId}: provider ${providerId}`);\n    if (!providerId) {\n      // Remove broadcaster\n      const {\n        error\n      } = await supabase.from('broadcasts').delete().eq('fixture_id', fixtureId);\n      if (error) throw error;\n      console.log(`[Supabase] Removed broadcaster for fixture ${fixtureId}`);\n    } else {\n      // Add/update broadcaster\n      const {\n        error\n      } = await supabase.from('broadcasts').upsert({\n        fixture_id: fixtureId,\n        provider_id: providerId\n      });\n      if (error) throw error;\n      console.log(`[Supabase] Saved broadcaster for fixture ${fixtureId}`);\n    }\n  } catch (error) {\n    console.error(`[Supabase] Error saving broadcaster:`, error);\n    throw error;\n  }\n}","map":{"version":3,"names":["createClient","supabaseUrl","process","env","REACT_APP_SUPABASE_URL","supabaseAnonKey","REACT_APP_SUPABASE_ANON_KEY","console","warn","supabase","SIMPLE_BROADCASTERS","id","name","getSimpleFixtures","log","now","Date","seasonYear","getUTCMonth","getUTCFullYear","seasonStartIso","data","fixtures","error","from","select","gte","order","ascending","length","teamIds","Array","Set","map","f","home_team_id","away_team_id","filter","Boolean","teamNameById","teams","teamError","in","forEach","t","fixtureIds","broadcasts","broadcastLookup","b","fixture_id","provider_id","fixture","_SIMPLE_BROADCASTERS$","kickoff_utc","utc_kickoff","home_team","away_team","broadcaster","find","undefined","saveBroadcaster","fixtureId","providerId","delete","eq","upsert"],"sources":["/Users/p/Documents/pl_tv_mvp_spa/react-version/src/services/supabase-simple.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// Get credentials from environment variables with fallbacks\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL || 'https://nkfuzkrazehjivzmdrvt.supabase.co';\nconst supabaseAnonKey = process.env.REACT_APP_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rZnV6a3JhemVoaml2em1kcnZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyNjI5MzAsImV4cCI6MjA3MjgzODkzMH0.CNW1EUtcC4JWfDy-WzOIVDfv7rnXzsz1qqQyRTZVyXU';\n\n// Log a warning if using fallback credentials\nif (!process.env.REACT_APP_SUPABASE_URL || !process.env.REACT_APP_SUPABASE_ANON_KEY) {\n  console.warn('[Supabase Simple] Using fallback credentials. Consider setting REACT_APP_SUPABASE_URL and REACT_APP_SUPABASE_ANON_KEY in your .env file.');\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n// Simple, minimal types\nexport interface SimpleFixture {\n  id: number;\n  kickoff_utc: string;\n  home_team: string;\n  away_team: string;\n  broadcaster?: string;\n}\n\n// Only Sky Sports and TNT Sports for simplicity\nexport const SIMPLE_BROADCASTERS = [\n  { id: 1, name: 'Sky Sports' },\n  { id: 2, name: 'TNT Sports' }\n];\n\n// Get fixtures with basic team info using simple JOINs\nexport async function getSimpleFixtures(): Promise<SimpleFixture[]> {\n  try {\n    console.log('[Supabase] Loading full season fixtures (no JOINs)...');\n\n    // Step 1: Load fixture basics only\n    // Use a dynamic season start (Aug 1 of current season year)\n    const now = new Date();\n    const seasonYear = now.getUTCMonth() >= 6 ? now.getUTCFullYear() : now.getUTCFullYear() - 1;\n    const seasonStartIso = `${seasonYear}-08-01T00:00:00.000Z`;\n\n    const { data: fixtures, error } = await supabase\n      .from('fixtures')\n      .select('id, utc_kickoff, home_team_id, away_team_id')\n      .gte('utc_kickoff', seasonStartIso)\n      .order('utc_kickoff', { ascending: true });\n\n    if (error) {\n      console.error('[Supabase] Error loading fixtures:', error);\n      throw error;\n    }\n    if (!fixtures || fixtures.length === 0) {\n      console.warn('[Supabase] No fixtures returned');\n      return [];\n    }\n\n    // Step 2: Load team names in one query\n    const teamIds = Array.from(\n      new Set([\n        ...fixtures.map((f: any) => f.home_team_id),\n        ...fixtures.map((f: any) => f.away_team_id),\n      ].filter(Boolean))\n    );\n\n    let teamNameById: Record<number, string> = {};\n    if (teamIds.length > 0) {\n      const { data: teams, error: teamError } = await supabase\n        .from('teams')\n        .select('id, name')\n        .in('id', teamIds);\n      if (teamError) {\n        console.warn('[Supabase] Error loading teams:', teamError);\n      } else {\n        (teams || []).forEach((t: any) => {\n          teamNameById[t.id] = t.name;\n        });\n      }\n    }\n\n    // Step 3: Load broadcasts for these fixtures\n    const fixtureIds = fixtures.map((f: any) => f.id);\n    const { data: broadcasts } = await supabase\n      .from('broadcasts')\n      .select('fixture_id, provider_id')\n      .in('fixture_id', fixtureIds);\n\n    const broadcastLookup: Record<number, number> = {};\n    (broadcasts || []).forEach((b: any) => {\n      broadcastLookup[b.fixture_id] = b.provider_id;\n    });\n\n    // Step 4: Map to simple format\n    return fixtures.map((fixture: any) => ({\n      id: fixture.id,\n      kickoff_utc: fixture.utc_kickoff,\n      home_team: teamNameById[fixture.home_team_id] || 'Unknown',\n      away_team: teamNameById[fixture.away_team_id] || 'Unknown',\n      broadcaster: SIMPLE_BROADCASTERS.find(b => b.id === broadcastLookup[fixture.id])?.name || undefined,\n    }));\n  } catch (error) {\n    console.error('[Supabase] Unexpected error:', error);\n    return [];\n  }\n}\n\n// Save broadcaster assignment (simple)\nexport async function saveBroadcaster(fixtureId: number, providerId: number | null): Promise<void> {\n  try {\n    console.log(`[Supabase] Saving broadcaster for fixture ${fixtureId}: provider ${providerId}`);\n    \n    if (!providerId) {\n      // Remove broadcaster\n      const { error } = await supabase\n        .from('broadcasts')\n        .delete()\n        .eq('fixture_id', fixtureId);\n        \n      if (error) throw error;\n      console.log(`[Supabase] Removed broadcaster for fixture ${fixtureId}`);\n    } else {\n      // Add/update broadcaster\n      const { error } = await supabase\n        .from('broadcasts')\n        .upsert({\n          fixture_id: fixtureId,\n          provider_id: providerId\n        });\n        \n      if (error) throw error;\n      console.log(`[Supabase] Saved broadcaster for fixture ${fixtureId}`);\n    }\n  } catch (error) {\n    console.error(`[Supabase] Error saving broadcaster:`, error);\n    throw error;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}