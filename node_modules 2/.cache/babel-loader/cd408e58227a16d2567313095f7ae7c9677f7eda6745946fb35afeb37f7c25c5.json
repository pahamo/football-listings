{"ast":null,"code":"import { createClient } from '@supabase/supabase-js';\nconst supabaseUrl = 'https://nkfuzkrazehjivzmdrvt.supabase.co';\nconst supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rZnV6a3JhemVoaml2em1kcnZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyNjI5MzAsImV4cCI6MjA3MjgzODkzMH0.CNW1EUtcC4JWfDy-WzOIVDfv7rnXzsz1qqQyRTZVyXU';\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n// Simple, minimal types\n\n// Only Sky Sports and TNT Sports for simplicity\nexport const SIMPLE_BROADCASTERS = [{\n  id: 1,\n  name: 'Sky Sports'\n}, {\n  id: 2,\n  name: 'TNT Sports'\n}];\n\n// Get fixtures with basic team info using simple JOINs\nexport async function getSimpleFixtures() {\n  try {\n    console.log('[Supabase] Loading fixtures (no JOINs)...');\n\n    // Step 1: Load fixture basics only\n    // Use a dynamic season start (Aug 1 of current season year)\n    const now = new Date();\n    const seasonYear = now.getUTCMonth() >= 6 ? now.getUTCFullYear() : now.getUTCFullYear() - 1;\n    const seasonStartIso = `${seasonYear}-08-01T00:00:00.000Z`;\n    const {\n      data: fixtures,\n      error\n    } = await supabase.from('fixtures').select('id, utc_kickoff, home_team_id, away_team_id').gte('utc_kickoff', seasonStartIso).order('utc_kickoff', {\n      ascending: true\n    }).limit(20);\n    if (error) {\n      console.error('[Supabase] Error loading fixtures:', error);\n      throw error;\n    }\n    if (!fixtures || fixtures.length === 0) {\n      console.warn('[Supabase] No fixtures returned');\n      return [];\n    }\n\n    // Step 2: Load team names in one query\n    const teamIds = Array.from(new Set([...fixtures.map(f => f.home_team_id), ...fixtures.map(f => f.away_team_id)].filter(Boolean)));\n    let teamNameById = {};\n    if (teamIds.length > 0) {\n      const {\n        data: teams,\n        error: teamError\n      } = await supabase.from('teams').select('id, name').in('id', teamIds);\n      if (teamError) {\n        console.warn('[Supabase] Error loading teams:', teamError);\n      } else {\n        (teams || []).forEach(t => {\n          teamNameById[t.id] = t.name;\n        });\n      }\n    }\n\n    // Step 3: Load broadcasts for these fixtures\n    const fixtureIds = fixtures.map(f => f.id);\n    const {\n      data: broadcasts\n    } = await supabase.from('broadcasts').select('fixture_id, provider_id').in('fixture_id', fixtureIds);\n    const broadcastLookup = {};\n    (broadcasts || []).forEach(b => {\n      broadcastLookup[b.fixture_id] = b.provider_id;\n    });\n\n    // Step 4: Map to simple format\n    return fixtures.map(fixture => {\n      var _SIMPLE_BROADCASTERS$;\n      return {\n        id: fixture.id,\n        kickoff_utc: fixture.utc_kickoff,\n        home_team: teamNameById[fixture.home_team_id] || 'Unknown',\n        away_team: teamNameById[fixture.away_team_id] || 'Unknown',\n        broadcaster: ((_SIMPLE_BROADCASTERS$ = SIMPLE_BROADCASTERS.find(b => b.id === broadcastLookup[fixture.id])) === null || _SIMPLE_BROADCASTERS$ === void 0 ? void 0 : _SIMPLE_BROADCASTERS$.name) || undefined\n      };\n    });\n  } catch (error) {\n    console.error('[Supabase] Unexpected error:', error);\n    return [];\n  }\n}\n\n// Save broadcaster assignment (simple)\nexport async function saveBroadcaster(fixtureId, providerId) {\n  try {\n    console.log(`[Supabase] Saving broadcaster for fixture ${fixtureId}: provider ${providerId}`);\n    if (!providerId) {\n      // Remove broadcaster\n      const {\n        error\n      } = await supabase.from('broadcasts').delete().eq('fixture_id', fixtureId);\n      if (error) throw error;\n      console.log(`[Supabase] Removed broadcaster for fixture ${fixtureId}`);\n    } else {\n      // Add/update broadcaster\n      const {\n        error\n      } = await supabase.from('broadcasts').upsert({\n        fixture_id: fixtureId,\n        provider_id: providerId\n      });\n      if (error) throw error;\n      console.log(`[Supabase] Saved broadcaster for fixture ${fixtureId}`);\n    }\n  } catch (error) {\n    console.error(`[Supabase] Error saving broadcaster:`, error);\n    throw error;\n  }\n}","map":{"version":3,"names":["createClient","supabaseUrl","supabaseAnonKey","supabase","SIMPLE_BROADCASTERS","id","name","getSimpleFixtures","console","log","now","Date","seasonYear","getUTCMonth","getUTCFullYear","seasonStartIso","data","fixtures","error","from","select","gte","order","ascending","limit","length","warn","teamIds","Array","Set","map","f","home_team_id","away_team_id","filter","Boolean","teamNameById","teams","teamError","in","forEach","t","fixtureIds","broadcasts","broadcastLookup","b","fixture_id","provider_id","fixture","_SIMPLE_BROADCASTERS$","kickoff_utc","utc_kickoff","home_team","away_team","broadcaster","find","undefined","saveBroadcaster","fixtureId","providerId","delete","eq","upsert"],"sources":["/Users/p/Documents/pl_tv_mvp_spa/react-version/src/services/supabase-simple.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = 'https://nkfuzkrazehjivzmdrvt.supabase.co';\nconst supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rZnV6a3JhemVoaml2em1kcnZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyNjI5MzAsImV4cCI6MjA3MjgzODkzMH0.CNW1EUtcC4JWfDy-WzOIVDfv7rnXzsz1qqQyRTZVyXU';\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n// Simple, minimal types\nexport interface SimpleFixture {\n  id: number;\n  kickoff_utc: string;\n  home_team: string;\n  away_team: string;\n  broadcaster?: string;\n}\n\n// Only Sky Sports and TNT Sports for simplicity\nexport const SIMPLE_BROADCASTERS = [\n  { id: 1, name: 'Sky Sports' },\n  { id: 2, name: 'TNT Sports' }\n];\n\n// Get fixtures with basic team info using simple JOINs\nexport async function getSimpleFixtures(): Promise<SimpleFixture[]> {\n  try {\n    console.log('[Supabase] Loading fixtures (no JOINs)...');\n\n    // Step 1: Load fixture basics only\n    // Use a dynamic season start (Aug 1 of current season year)\n    const now = new Date();\n    const seasonYear = now.getUTCMonth() >= 6 ? now.getUTCFullYear() : now.getUTCFullYear() - 1;\n    const seasonStartIso = `${seasonYear}-08-01T00:00:00.000Z`;\n\n    const { data: fixtures, error } = await supabase\n      .from('fixtures')\n      .select('id, utc_kickoff, home_team_id, away_team_id')\n      .gte('utc_kickoff', seasonStartIso)\n      .order('utc_kickoff', { ascending: true })\n      .limit(20);\n\n    if (error) {\n      console.error('[Supabase] Error loading fixtures:', error);\n      throw error;\n    }\n    if (!fixtures || fixtures.length === 0) {\n      console.warn('[Supabase] No fixtures returned');\n      return [];\n    }\n\n    // Step 2: Load team names in one query\n    const teamIds = Array.from(\n      new Set([\n        ...fixtures.map((f: any) => f.home_team_id),\n        ...fixtures.map((f: any) => f.away_team_id),\n      ].filter(Boolean))\n    );\n\n    let teamNameById: Record<number, string> = {};\n    if (teamIds.length > 0) {\n      const { data: teams, error: teamError } = await supabase\n        .from('teams')\n        .select('id, name')\n        .in('id', teamIds);\n      if (teamError) {\n        console.warn('[Supabase] Error loading teams:', teamError);\n      } else {\n        (teams || []).forEach((t: any) => {\n          teamNameById[t.id] = t.name;\n        });\n      }\n    }\n\n    // Step 3: Load broadcasts for these fixtures\n    const fixtureIds = fixtures.map((f: any) => f.id);\n    const { data: broadcasts } = await supabase\n      .from('broadcasts')\n      .select('fixture_id, provider_id')\n      .in('fixture_id', fixtureIds);\n\n    const broadcastLookup: Record<number, number> = {};\n    (broadcasts || []).forEach((b: any) => {\n      broadcastLookup[b.fixture_id] = b.provider_id;\n    });\n\n    // Step 4: Map to simple format\n    return fixtures.map((fixture: any) => ({\n      id: fixture.id,\n      kickoff_utc: fixture.utc_kickoff,\n      home_team: teamNameById[fixture.home_team_id] || 'Unknown',\n      away_team: teamNameById[fixture.away_team_id] || 'Unknown',\n      broadcaster: SIMPLE_BROADCASTERS.find(b => b.id === broadcastLookup[fixture.id])?.name || undefined,\n    }));\n  } catch (error) {\n    console.error('[Supabase] Unexpected error:', error);\n    return [];\n  }\n}\n\n// Save broadcaster assignment (simple)\nexport async function saveBroadcaster(fixtureId: number, providerId: number | null): Promise<void> {\n  try {\n    console.log(`[Supabase] Saving broadcaster for fixture ${fixtureId}: provider ${providerId}`);\n    \n    if (!providerId) {\n      // Remove broadcaster\n      const { error } = await supabase\n        .from('broadcasts')\n        .delete()\n        .eq('fixture_id', fixtureId);\n        \n      if (error) throw error;\n      console.log(`[Supabase] Removed broadcaster for fixture ${fixtureId}`);\n    } else {\n      // Add/update broadcaster\n      const { error } = await supabase\n        .from('broadcasts')\n        .upsert({\n          fixture_id: fixtureId,\n          provider_id: providerId\n        });\n        \n      if (error) throw error;\n      console.log(`[Supabase] Saved broadcaster for fixture ${fixtureId}`);\n    }\n  } catch (error) {\n    console.error(`[Supabase] Error saving broadcaster:`, error);\n    throw error;\n  }\n}\n"],"mappings":"AAAA,SAASA,YAAY,QAAQ,uBAAuB;AAEpD,MAAMC,WAAW,GAAG,0CAA0C;AAC9D,MAAMC,eAAe,GAAG,kNAAkN;AAE1O,OAAO,MAAMC,QAAQ,GAAGH,YAAY,CAACC,WAAW,EAAEC,eAAe,CAAC;;AAElE;;AASA;AACA,OAAO,MAAME,mBAAmB,GAAG,CACjC;EAAEC,EAAE,EAAE,CAAC;EAAEC,IAAI,EAAE;AAAa,CAAC,EAC7B;EAAED,EAAE,EAAE,CAAC;EAAEC,IAAI,EAAE;AAAa,CAAC,CAC9B;;AAED;AACA,OAAO,eAAeC,iBAAiBA,CAAA,EAA6B;EAClE,IAAI;IACFC,OAAO,CAACC,GAAG,CAAC,2CAA2C,CAAC;;IAExD;IACA;IACA,MAAMC,GAAG,GAAG,IAAIC,IAAI,CAAC,CAAC;IACtB,MAAMC,UAAU,GAAGF,GAAG,CAACG,WAAW,CAAC,CAAC,IAAI,CAAC,GAAGH,GAAG,CAACI,cAAc,CAAC,CAAC,GAAGJ,GAAG,CAACI,cAAc,CAAC,CAAC,GAAG,CAAC;IAC3F,MAAMC,cAAc,GAAG,GAAGH,UAAU,sBAAsB;IAE1D,MAAM;MAAEI,IAAI,EAAEC,QAAQ;MAAEC;IAAM,CAAC,GAAG,MAAMf,QAAQ,CAC7CgB,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,6CAA6C,CAAC,CACrDC,GAAG,CAAC,aAAa,EAAEN,cAAc,CAAC,CAClCO,KAAK,CAAC,aAAa,EAAE;MAAEC,SAAS,EAAE;IAAK,CAAC,CAAC,CACzCC,KAAK,CAAC,EAAE,CAAC;IAEZ,IAAIN,KAAK,EAAE;MACTV,OAAO,CAACU,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;MAC1D,MAAMA,KAAK;IACb;IACA,IAAI,CAACD,QAAQ,IAAIA,QAAQ,CAACQ,MAAM,KAAK,CAAC,EAAE;MACtCjB,OAAO,CAACkB,IAAI,CAAC,iCAAiC,CAAC;MAC/C,OAAO,EAAE;IACX;;IAEA;IACA,MAAMC,OAAO,GAAGC,KAAK,CAACT,IAAI,CACxB,IAAIU,GAAG,CAAC,CACN,GAAGZ,QAAQ,CAACa,GAAG,CAAEC,CAAM,IAAKA,CAAC,CAACC,YAAY,CAAC,EAC3C,GAAGf,QAAQ,CAACa,GAAG,CAAEC,CAAM,IAAKA,CAAC,CAACE,YAAY,CAAC,CAC5C,CAACC,MAAM,CAACC,OAAO,CAAC,CACnB,CAAC;IAED,IAAIC,YAAoC,GAAG,CAAC,CAAC;IAC7C,IAAIT,OAAO,CAACF,MAAM,GAAG,CAAC,EAAE;MACtB,MAAM;QAAET,IAAI,EAAEqB,KAAK;QAAEnB,KAAK,EAAEoB;MAAU,CAAC,GAAG,MAAMnC,QAAQ,CACrDgB,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC,UAAU,CAAC,CAClBmB,EAAE,CAAC,IAAI,EAAEZ,OAAO,CAAC;MACpB,IAAIW,SAAS,EAAE;QACb9B,OAAO,CAACkB,IAAI,CAAC,iCAAiC,EAAEY,SAAS,CAAC;MAC5D,CAAC,MAAM;QACL,CAACD,KAAK,IAAI,EAAE,EAAEG,OAAO,CAAEC,CAAM,IAAK;UAChCL,YAAY,CAACK,CAAC,CAACpC,EAAE,CAAC,GAAGoC,CAAC,CAACnC,IAAI;QAC7B,CAAC,CAAC;MACJ;IACF;;IAEA;IACA,MAAMoC,UAAU,GAAGzB,QAAQ,CAACa,GAAG,CAAEC,CAAM,IAAKA,CAAC,CAAC1B,EAAE,CAAC;IACjD,MAAM;MAAEW,IAAI,EAAE2B;IAAW,CAAC,GAAG,MAAMxC,QAAQ,CACxCgB,IAAI,CAAC,YAAY,CAAC,CAClBC,MAAM,CAAC,yBAAyB,CAAC,CACjCmB,EAAE,CAAC,YAAY,EAAEG,UAAU,CAAC;IAE/B,MAAME,eAAuC,GAAG,CAAC,CAAC;IAClD,CAACD,UAAU,IAAI,EAAE,EAAEH,OAAO,CAAEK,CAAM,IAAK;MACrCD,eAAe,CAACC,CAAC,CAACC,UAAU,CAAC,GAAGD,CAAC,CAACE,WAAW;IAC/C,CAAC,CAAC;;IAEF;IACA,OAAO9B,QAAQ,CAACa,GAAG,CAAEkB,OAAY;MAAA,IAAAC,qBAAA;MAAA,OAAM;QACrC5C,EAAE,EAAE2C,OAAO,CAAC3C,EAAE;QACd6C,WAAW,EAAEF,OAAO,CAACG,WAAW;QAChCC,SAAS,EAAEhB,YAAY,CAACY,OAAO,CAAChB,YAAY,CAAC,IAAI,SAAS;QAC1DqB,SAAS,EAAEjB,YAAY,CAACY,OAAO,CAACf,YAAY,CAAC,IAAI,SAAS;QAC1DqB,WAAW,EAAE,EAAAL,qBAAA,GAAA7C,mBAAmB,CAACmD,IAAI,CAACV,CAAC,IAAIA,CAAC,CAACxC,EAAE,KAAKuC,eAAe,CAACI,OAAO,CAAC3C,EAAE,CAAC,CAAC,cAAA4C,qBAAA,uBAAnEA,qBAAA,CAAqE3C,IAAI,KAAIkD;MAC5F,CAAC;IAAA,CAAC,CAAC;EACL,CAAC,CAAC,OAAOtC,KAAK,EAAE;IACdV,OAAO,CAACU,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;IACpD,OAAO,EAAE;EACX;AACF;;AAEA;AACA,OAAO,eAAeuC,eAAeA,CAACC,SAAiB,EAAEC,UAAyB,EAAiB;EACjG,IAAI;IACFnD,OAAO,CAACC,GAAG,CAAC,6CAA6CiD,SAAS,cAAcC,UAAU,EAAE,CAAC;IAE7F,IAAI,CAACA,UAAU,EAAE;MACf;MACA,MAAM;QAAEzC;MAAM,CAAC,GAAG,MAAMf,QAAQ,CAC7BgB,IAAI,CAAC,YAAY,CAAC,CAClByC,MAAM,CAAC,CAAC,CACRC,EAAE,CAAC,YAAY,EAAEH,SAAS,CAAC;MAE9B,IAAIxC,KAAK,EAAE,MAAMA,KAAK;MACtBV,OAAO,CAACC,GAAG,CAAC,8CAA8CiD,SAAS,EAAE,CAAC;IACxE,CAAC,MAAM;MACL;MACA,MAAM;QAAExC;MAAM,CAAC,GAAG,MAAMf,QAAQ,CAC7BgB,IAAI,CAAC,YAAY,CAAC,CAClB2C,MAAM,CAAC;QACNhB,UAAU,EAAEY,SAAS;QACrBX,WAAW,EAAEY;MACf,CAAC,CAAC;MAEJ,IAAIzC,KAAK,EAAE,MAAMA,KAAK;MACtBV,OAAO,CAACC,GAAG,CAAC,4CAA4CiD,SAAS,EAAE,CAAC;IACtE;EACF,CAAC,CAAC,OAAOxC,KAAK,EAAE;IACdV,OAAO,CAACU,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;IAC5D,MAAMA,KAAK;EACb;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}