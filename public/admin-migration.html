<!DOCTYPE html>
<html>
<head>
    <title>Smart Slug Migration Tool</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 10px 0; }
        .log { background: #000; color: #0f0; padding: 15px; font-family: monospace; height: 400px; overflow-y: auto; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; }
        .success { background: #4CAF50; color: white; border: none; }
        .warning { background: #ff9800; color: white; border: none; }
        .step { background: #2196F3; color: white; border: none; }
    </style>
</head>
<body>
    <h1>üöÄ Smart Slug Migration Tool</h1>

    <div class="container">
        <h3>Migration Steps</h3>
        <button class="step" onclick="addColumn()">Step 1: Add url_slug Column</button>
        <button class="step" onclick="generateSlugs()">Step 2: Generate Smart Slugs</button>
        <button class="warning" onclick="testQuery()">Test: Check Results</button>
        <button class="success" onclick="clearLog()">Clear Log</button>
    </div>

    <div class="log" id="log">Ready to start migration...\n</div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // This will use the same environment variables as your React app
        const SUPABASE_URL = 'https://cjhcrjfogpakmdgdgmdl.supabase.co'; // Your actual URL
        const ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNqaGNyamZvZ3Bha21kZ2RnbWRsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjY1NzE3MjAsImV4cCI6MjA0MjE0NzcyMH0.ORMdcAMp2CzVJNHIoJ8z7bLaxXXgdtVnYOzJ_scskqQ'; // Your anon key
        // Note: For migrations we need service role key, but we can't expose it in browser
        // This approach won't work - we need server-side execution

        const supabase = window.supabase.createClient(SUPABASE_URL, ANON_KEY);

        function log(message) {
            const logElement = document.getElementById('log');
            logElement.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').textContent = 'Log cleared...\n';
        }

        async function addColumn() {
            log('‚ùå This approach cannot work from browser due to security restrictions');
            log('The service role key cannot be exposed in client-side code');
            log('');
            log('‚úÖ Alternative: I will create a working Netlify function');
        }

        async function generateSlugs() {
            log('Waiting for column creation step...');
        }

        async function testQuery() {
            log('Testing basic query with anon key...');
            try {
                const { data, error } = await supabase
                    .from('teams')
                    .select('id, name, slug')
                    .limit(3);

                if (error) {
                    log('‚ùå Query error: ' + error.message);
                } else {
                    log('‚úÖ Basic query works, found ' + data.length + ' teams');
                    log('Sample: ' + JSON.stringify(data[0], null, 2));
                }
            } catch (err) {
                log('‚ùå Exception: ' + err.message);
            }
        }
    </script>

    <div class="container">
        <h3>Manual Alternative</h3>
        <p>Since Netlify functions are having issues, I'll create a working server-side solution.</p>
        <p>The migration needs to run with service role permissions which can't be done from browser.</p>
    </div>
</body>
</html>